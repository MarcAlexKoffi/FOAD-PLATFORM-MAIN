<div class="foad-page foad-rdv">
  <main class="container">
    <!-- Heading + CTA -->
    <header class="page-head">
      <h1>Gestion des rendez-vous</h1>
      <button class="btn btn-primary" (click)="openRdvForm()">
        <span class="mi">add</span>
        Créer un rendez-vous
      </button>

      <!-- Modal formulaire -->
      <app-rdv-form
        *ngIf="showForm"
        [initialDate]="selectedDate"
        (formClosed)="closeRdvForm($event)">
      </app-rdv-form>
    </header>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active">À venir</button>
      <button class="tab">Passés</button>
      <button class="tab">Annulés</button>
    </nav>

    <div class="layout">
      <!-- Colonne gauche -->
      <aside class="left">
        <!-- Search -->
        <div class="input-search">
          <span class="search-icon mi">search</span>
          <input type="text" placeholder="Rechercher…" aria-label="Rechercher" />
        </div>

        <!-- Chips -->
        <div class="chips">
          <button class="chip">
            <span class="mi">rule</span>
            Statut
            <span class="mi">expand_more</span>
          </button>
          <button class="chip">
            <span class="mi">group</span>
            Participants
            <span class="mi">expand_more</span>
          </button>
        </div>

        <!-- Calendrier -->
        <section class="card calendar">
          <header class="cal-head">
            <button class="btn-ico" aria-label="Précédent" (click)="prevMonth()">
              <span class="mi">chevron_left</span>
            </button>
            <h3>{{ monthLabel | titlecase }}</h3>
            <button class="btn-ico" aria-label="Suivant" (click)="nextMonth()">
              <span class="mi">chevron_right</span>
            </button>
          </header>

          <div class="cal-grid cal-days">
            <span>D</span><span>L</span><span>M</span><span>M</span><span>J</span><span>V</span><span>S</span>
          </div>

          <div class="cal-grid cal-dates">
            <ng-container *ngFor="let day of daysInMonth">
              <!-- cases vides -->
              <span *ngIf="day === 0"></span>

              <!-- jours -->
              <button
                *ngIf="day !== 0"
                (click)="selectDate(day)"
                [class.current]="selectedDate?.getDate() === day &&
                                 selectedDate?.getMonth() === currentMonth &&
                                 selectedDate?.getFullYear() === currentYear"
                [class.today]="day === today.getDate() &&
                               currentMonth === today.getMonth() &&
                               currentYear === today.getFullYear()"
                [class.has-dot]="getEventsForDay(day).length > 0"
                title="Cliquer pour sélectionner la date">
                {{ day }}
              </button>
            </ng-container>
          </div>
        </section>
      </aside>

      <!-- Colonne droite : cartes RDV (dynamiques) -->
      <section class="right">
        <!-- À venir -->
        <ng-container *ngIf="upcoming().length; else noUpcoming">
          <article class="card rdv" *ngFor="let a of upcoming()">
            <div class="rdv-row">
              <div class="row-left">
                <span class="mi muted">calendar_today</span>
                <!-- DATE-HEURE visible -->
                <span class="meta">{{ a.dateHeure | date:'d MMMM y — HH:mm':'':'fr' }}</span>
              </div>
              <span class="pill pill-up"><span class="dot"></span> À venir</span>
              <div class="row-actions">
                <button class="btn-ico" title="Modifier"><span class="mi">edit</span></button>
                <button class="btn-ico" title="Supprimer" (click)="remove(a.id)"><span class="mi">delete</span></button>
              </div>
            </div>

            <!-- OBJET visible -->
            <h3>{{ a.objet || '—' }}</h3>

            <div class="avatars">
              <img src="https://i.pravatar.cc/40?img=1" alt="">
              <img src="https://i.pravatar.cc/40?img=2" alt="">
              <img src="https://i.pravatar.cc/40?img=3" alt="">
            </div>
          </article>
        </ng-container>
        <ng-template #noUpcoming>
          <article class="card rdv is-dim">
            <h3 class="muted">Aucun rendez-vous à venir</h3>
          </article>
        </ng-template>

        <!-- Passés -->
        <article class="card rdv is-dim" *ngFor="let a of past()">
          <div class="rdv-row">
            <div class="row-left">
              <span class="mi muted">calendar_today</span>
              <span class="meta">{{ a.dateHeure | date:'d MMMM y — HH:mm':'':'fr' }}</span>
            </div>
            <span class="pill pill-past"><span class="dot"></span> Passé</span>
          </div>
          <h3 class="muted">{{ a.objet || '—' }}</h3>
          <div class="avatars">
            <img src="https://i.pravatar.cc/40?img=4" alt="">
            <img src="https://i.pravatar.cc/40?img=5" alt="">
          </div>
        </article>

        <!-- Annulés -->
        <article class="card rdv is-dim" *ngFor="let a of cancelled()">
          <div class="rdv-row">
            <div class="row-left">
              <span class="mi muted">calendar_today</span>
              <span class="meta">{{ a.dateHeure | date:'d MMMM y — HH:mm':'':'fr' }}</span>
            </div>
            <span class="pill pill-cancel"><span class="dot"></span> Annulé</span>
          </div>
          <h3 class="muted strike">{{ a.objet || '—' }}</h3>
          <div class="avatars">
            <img src="https://i.pravatar.cc/40?img=6" alt="">
            <img src="https://i.pravatar.cc/40?img=7" alt="">
          </div>
        </article>
      </section>
    </div>
  </main>
</div>
